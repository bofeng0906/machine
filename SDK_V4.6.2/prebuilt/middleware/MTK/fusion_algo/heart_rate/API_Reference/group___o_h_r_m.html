<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Optical Heart rate Monitor (OHRM): OHRM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MediaTek.PNG"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Optical Heart rate Monitor (OHRM)
   &#160;<span id="projectnumber">1.0.0.45</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___o_h_r_m.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">OHRM</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__ohrm__define"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ohrm__define.html">Define</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__ohrm__struct"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ohrm__struct.html">Struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaba00c6bb4e04f25fae9e3a70e3c7b593"><td class="memItemLeft" align="right" valign="top">UINT32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#gaba00c6bb4e04f25fae9e3a70e3c7b593">ohrm_get_version</a> (void)</td></tr>
<tr class="memdesc:gaba00c6bb4e04f25fae9e3a70e3c7b593"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the OHRM library version code.  <a href="#gaba00c6bb4e04f25fae9e3a70e3c7b593">More...</a><br /></td></tr>
<tr class="separator:gaba00c6bb4e04f25fae9e3a70e3c7b593"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3d14aa4a70f27119b8b18537e6cfd9be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#ga3d14aa4a70f27119b8b18537e6cfd9be">ohrm_process</a> (<a class="el" href="structohrm__data__t.html">ohrm_data_t</a> *ohrm_signal_in, INT32 fs_compare_ratio, INT32 *ohrm_out)</td></tr>
<tr class="memdesc:ga3d14aa4a70f27119b8b18537e6cfd9be"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function should be called when new data comes (PPG and motion signal are processed separatly).  <a href="#ga3d14aa4a70f27119b8b18537e6cfd9be">More...</a><br /></td></tr>
<tr class="separator:ga3d14aa4a70f27119b8b18537e6cfd9be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga953ebd2c2e3457141bb42578e10c11f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#ga953ebd2c2e3457141bb42578e10c11f5">ohrm_init</a> (INT32 ohrm_motion_represent_1g)</td></tr>
<tr class="memdesc:ga953ebd2c2e3457141bb42578e10c11f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function should be called at the initialization stage.  <a href="#ga953ebd2c2e3457141bb42578e10c11f5">More...</a><br /></td></tr>
<tr class="separator:ga953ebd2c2e3457141bb42578e10c11f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ee3c5a24c0012bbeeba1399618a26f8"><td class="memItemLeft" align="right" valign="top">INT32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#ga4ee3c5a24c0012bbeeba1399618a26f8">ohrm_get_bpm</a> (void)</td></tr>
<tr class="memdesc:ga4ee3c5a24c0012bbeeba1399618a26f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the HR BPM value from optical heart rate monitor.  <a href="#ga4ee3c5a24c0012bbeeba1399618a26f8">More...</a><br /></td></tr>
<tr class="separator:ga4ee3c5a24c0012bbeeba1399618a26f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb74f91008e3a71d1618444e0394e0d1"><td class="memItemLeft" align="right" valign="top">INT32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#gaeb74f91008e3a71d1618444e0394e0d1">ohrm_get_time</a> (void)</td></tr>
<tr class="memdesc:gaeb74f91008e3a71d1618444e0394e0d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the OHRM timestamp (in seconds).  <a href="#gaeb74f91008e3a71d1618444e0394e0d1">More...</a><br /></td></tr>
<tr class="separator:gaeb74f91008e3a71d1618444e0394e0d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab446533fd5d1ddf6dd3c694fb517ea27"><td class="memItemLeft" align="right" valign="top">UINT32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___o_h_r_m.html#gab446533fd5d1ddf6dd3c694fb517ea27">ohrm_get_confidence_level</a> (void)</td></tr>
<tr class="memdesc:gab446533fd5d1ddf6dd3c694fb517ea27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to get the OHRM confidence level.  <a href="#gab446533fd5d1ddf6dd3c694fb517ea27">More...</a><br /></td></tr>
<tr class="separator:gab446533fd5d1ddf6dd3c694fb517ea27"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h1><a class="anchor" id="Terms_Chapter"></a>
Terms and acronyms</h1>
<table class="doxtable">
<tr>
<th>Terms </th><th>Details  </th></tr>
<tr>
<td><b>OHRM</b> </td><td>Optical heart rate monitor. </td></tr>
<tr>
<td><b>HR</b> </td><td>Heart Rate. For more information, please check <a href="https://en.wikipedia.org/wiki/Heart_rate">Heart Rate in Wikipedia </a>. </td></tr>
<tr>
<td><b>BPM</b> </td><td>Beats Per Minute. The common unit for heart rate value representation. </td></tr>
<tr>
<td><b>PPG</b> </td><td>Photoplethysmogram for optical HR sensing. For more information, please check <a href="https://en.wikipedia.org/wiki/Photoplethysmogram">PPG in Wikipedia </a>. </td></tr>
<tr>
<td><b>motion</b> </td><td>The signal acquired from accelerometer. </td></tr>
</table>
<h1><a class="anchor" id="Function_Block_Diagram"></a>
Control Flow: OHRM</h1>
<p>Initialization </p><div class="image">
<img src="Initial.png" alt="Initial.png"/>
</div>
<p> Measurement </p><div class="image">
<img src="Measurement.png" alt="Measurement.png"/>
</div>
<h1><a class="anchor" id="OHRM_Usage_Chapter"></a>
How to use OHRM APIs</h1>
<p>Step 1: Call <a class="el" href="group___o_h_r_m.html#ga953ebd2c2e3457141bb42578e10c11f5" title="This function should be called at the initialization stage. ">ohrm_init()</a> to initialize the OHRM library. The input value should have the correct representation of 1 g-force data. The dynamic range of accelerometer should be set to +/-8g in oder to prevent signal saturation under heavy motion condition. <br />
Step 2: Call <a class="el" href="group___o_h_r_m.html#ga3d14aa4a70f27119b8b18537e6cfd9be" title="This function should be called when new data comes (PPG and motion signal are processed separatly)...">ohrm_process()</a> when PPG data or motion data is received. <br />
 Step 3: Call <a class="el" href="group___o_h_r_m.html#ga4ee3c5a24c0012bbeeba1399618a26f8" title="Call this function to get the HR BPM value from optical heart rate monitor. ">ohrm_get_bpm()</a> to get the heart rate BPM value, after the PPG data has been processed by <a class="el" href="group___o_h_r_m.html#ga3d14aa4a70f27119b8b18537e6cfd9be" title="This function should be called when new data comes (PPG and motion signal are processed separatly)...">ohrm_process()</a>. <br />
</p><ul>
<li>sample code: <div class="fragment"><div class="line"><a class="code" href="structohrm__data__t.html">ohrm_data_t</a> param_ppg1;   <span class="comment">// The input PPG data structure for #ohrm_process().</span></div><div class="line"><a class="code" href="structohrm__data__t.html">ohrm_data_t</a> param_motion; <span class="comment">// The input motion data structure for #ohrm_process().</span></div><div class="line">INT32 *data_input_ppg;       <span class="comment">// The input data buffer of the PPG signal.</span></div><div class="line">INT32 *data_input_motion;    <span class="comment">// The input data buffer of the motion signal.</span></div><div class="line">INT32 fs_input_ppg = 125;    <span class="comment">// The input sample rate of the PPG signal (supports 125Hz only).</span></div><div class="line">INT32 fs_input_motion = 125; <span class="comment">// The input sample rate of the motion signal (support 125Hz only).</span></div><div class="line">INT32 bit_width_ppg = 23;    <span class="comment">// The PPG bit width (default value is 23 bits for MediaTek MT2511). Note: if the data is signed, set bit width to 32 bits.</span></div><div class="line">INT32 bit_width_motion = 32; <span class="comment">// The motion bit width. Note: if the data is signed, set bit width to 32 bits.</span></div><div class="line">INT32 *ohrm_out;             <span class="comment">// Output result for debugging purposes from #ohrm_process().</span></div><div class="line">INT32 ohrm_fs_compare_ratio = 0x1000; <span class="comment">// 0x1000 means 1X (motion fs = PPG fs).</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> example(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">     <span class="comment">// Initialization</span></div><div class="line">     <a class="code" href="group___o_h_r_m.html#ga953ebd2c2e3457141bb42578e10c11f5">ohrm_init</a>(256); <span class="comment">//For example: 1 g-force magnitude of the accelerometer data is represented by 256 codes in this case.</span></div><div class="line"></div><div class="line">     <span class="keywordflow">switch</span>(state)</div><div class="line">     {</div><div class="line">     <span class="comment">//Get accelerometer samples from motion driver.</span></div><div class="line">     <span class="keywordflow">case</span> MOTION_DATA_READY: </div><div class="line">         <span class="comment">// motion processing</span></div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#aa7abc37d80b126d3ec704c3fb5605a79">data</a> = data_input_motion;</div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#afec4bed6b5ebde425ece13af88bd7c64">data_fs</a> = fs_input_motion; </div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#a6844610b135b7cff4f64322d7a101175">data_length</a> = fs_input_motion; <span class="comment">//1-second as an example</span></div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#addef7b9da804310c17857f497828e721">data_bit_width</a> = bit_width_motion; </div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#a8622d31ef7078403377e5acfd56ac2c9">data_config</a> = 0; <span class="comment">// For motion, currently fixed to 0</span></div><div class="line">         param_motion.<a class="code" href="structohrm__data__t.html#a9b612a9141973ac26200f34099a30f7f">data_source</a> = 0; <span class="comment">// 0: motion </span></div><div class="line">         <a class="code" href="group___o_h_r_m.html#ga3d14aa4a70f27119b8b18537e6cfd9be">ohrm_process</a>(&amp;param_motion, ohrm_fs_compare_ratio, ohrm_out);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">     <span class="comment">//Get PPG samples from MT2511 vsm_driver.</span></div><div class="line">     <span class="keywordflow">case</span> PPG_DATA_READY: </div><div class="line">         <span class="comment">// PPG processing</span></div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#aa7abc37d80b126d3ec704c3fb5605a79">data</a> = data_input_ppg;</div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#afec4bed6b5ebde425ece13af88bd7c64">data_fs</a> = fs_input_ppg; </div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#a6844610b135b7cff4f64322d7a101175">data_length</a> = fs_input_ppg*2; <span class="comment">//Apply 1-second PPG input as an example (i.e. 1-sec PPG includes 250 samples).</span></div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#addef7b9da804310c17857f497828e721">data_bit_width</a> = bit_width_ppg;</div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#a8622d31ef7078403377e5acfd56ac2c9">data_config</a> = 2; <span class="comment">// For PPG, currently fixed to 2.</span></div><div class="line">         param_ppg1.<a class="code" href="structohrm__data__t.html#a9b612a9141973ac26200f34099a30f7f">data_source</a> = 1; <span class="comment">// 1: PPG</span></div><div class="line">         <a class="code" href="group___o_h_r_m.html#ga3d14aa4a70f27119b8b18537e6cfd9be">ohrm_process</a>(&amp;param_ppg1, ohrm_fs_compare_ratio, ohrm_out);</div><div class="line"></div><div class="line">         <span class="comment">// Output heart rate</span></div><div class="line">         bpm = <a class="code" href="group___o_h_r_m.html#ga4ee3c5a24c0012bbeeba1399618a26f8">ohrm_get_bpm</a>()&gt;&gt;16;</div><div class="line">         <span class="keywordflow">break</span>;</div><div class="line">     }</div><div class="line">}</div></div><!-- fragment --> </li>
</ul>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga4ee3c5a24c0012bbeeba1399618a26f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT32 ohrm_get_bpm </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the HR BPM value from optical heart rate monitor. </p>
<dl class="section return"><dt>Returns</dt><dd>Return the HR value in BPM. The return value is left-shifted 16 bits for fixed point representation. Right shift by 16 bits to get the integer value. </dd></dl>

</div>
</div>
<a class="anchor" id="gab446533fd5d1ddf6dd3c694fb517ea27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UINT32 ohrm_get_confidence_level </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the OHRM confidence level. </p>
<p>The confidence level is updated whenever HR value is updated. </p><dl class="section return"><dt>Returns</dt><dd>Return the OHRM confidence level. <br />
 The 8-bit LSB of the return value ranges between -1 (or 255 for unsigned value) to 3. <br />
 -1 (255): no contact <br />
 0: unreliable HR <br />
 1: low accuracy <br />
 2: medium accuracy <br />
 3: high accuracy <br />
 Suggested usage: maintain the last HR value or stop to display the HR value when the confidence level is -1, 0, or 1. </dd></dl>

</div>
</div>
<a class="anchor" id="gaeb74f91008e3a71d1618444e0394e0d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INT32 ohrm_get_time </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the OHRM timestamp (in seconds). </p>
<p>The timestamp is reset to zero when <a class="el" href="group___o_h_r_m.html#ga953ebd2c2e3457141bb42578e10c11f5" title="This function should be called at the initialization stage. ">ohrm_init()</a> is called. </p><dl class="section return"><dt>Returns</dt><dd>Return timestamp value in seconds. </dd></dl>

</div>
</div>
<a class="anchor" id="gaba00c6bb4e04f25fae9e3a70e3c7b593"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UINT32 ohrm_get_version </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to get the OHRM library version code. </p>
<dl class="section return"><dt>Returns</dt><dd>The return value of 0xAABBCCDD corresponds to version AA.BB.CC.DD. The integer value should be converted to heximal representation to get the version number. For example, 0x01000000 is for verion 1.0.0.0. </dd></dl>

</div>
</div>
<a class="anchor" id="ga953ebd2c2e3457141bb42578e10c11f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ohrm_init </td>
          <td>(</td>
          <td class="paramtype">INT32&#160;</td>
          <td class="paramname"><em>ohrm_motion_represent_1g</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function should be called at the initialization stage. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ohrm_motion_represent_1g</td><td>is the representation of 1 g-force magnitude from accelerometer input. For example, if the least significant bit of accelerometer input represents 0.001 g-force, then ohrm_motion_represent_1g should be set to 1000. The maximum range of accelerometer should be set to +/- 8 g-force to prevent signal saturation under heavy motion condition. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga3d14aa4a70f27119b8b18537e6cfd9be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ohrm_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structohrm__data__t.html">ohrm_data_t</a> *&#160;</td>
          <td class="paramname"><em>ohrm_signal_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT32&#160;</td>
          <td class="paramname"><em>fs_compare_ratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">INT32 *&#160;</td>
          <td class="paramname"><em>ohrm_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function should be called when new data comes (PPG and motion signal are processed separatly). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ohrm_signal_in</td><td>is the motion &amp; PPG input structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fs_compare_ratio</td><td>is defined as the ratio of the sampling rate of motion signal to the sampling rate of PPG. The value is left-shifted by 12 bits for fixed-point representation. For example, 4096 (0x1000) means the ratio equals to 1.0. The value of 3990 means that the ratio equals to 3990/4096. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ohrm_out</td><td>is for the debugging purposes of OHRM library. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Nov 1 2016 21:14:23 for Optical Heart rate Monitor (OHRM) by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
